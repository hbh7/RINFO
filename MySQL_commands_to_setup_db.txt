/* Run with 'mysql -u root -p < MySQL_commands_to_setup_db.txt' */

CREATE USER IF NOT EXISTS 'rinfo'@'localhost' IDENTIFIED BY 'RINFOServerPassword10302019';
DROP DATABASE IF EXISTS RINFO;
CREATE DATABASE RINFO;
GRANT ALL PRIVILEGES ON RINFO.* TO 'rinfo'@'localhost';
FLUSH PRIVILEGES;

USE RINFO;

CHARSET 'utf8';

CREATE TABLE r_users(
   user_id INT NOT NULL AUTO_INCREMENT,
   username VARCHAR(32) NOT NULL,
   password VARCHAR(128) NOT NULL,
   firstname VARCHAR(128) NOT NULL,
   lastname VARCHAR(128) NOT NULL,
   email VARCHAR(256) NOT NULL,
   logo VARCHAR(1024),
   enabled BOOLEAN DEFAULT true NOT NULL,
   PRIMARY KEY ( user_id )
);

CREATE TABLE r_groups(
    group_id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(128) NOT NULL,
    tagline VARCHAR(256) NOT NULL,
    logo VARCHAR(1024),
    visibility VARCHAR(10) NOT NULL,
    PRIMARY KEY ( group_id )
);

CREATE TABLE r_permissions(
    permission_id INT NOT NULL AUTO_INCREMENT,
    user_id INT NOT NULL,
    group_id INT NOT NULL,
    description VARCHAR(128) NOT NULL,
    PRIMARY KEY ( permission_id )
);

CREATE TABLE r_subscriptions(
    subscription_id INT NOT NULL AUTO_INCREMENT,
    user_id INT NOT NULL,
    group_id INT NOT NULL,
    PRIMARY KEY ( subscription_id )
);

CREATE TABLE r_posts(
    post_id INT NOT NULL AUTO_INCREMENT,
    group_id INT NOT NULL,
    user_id INT NOT NULL,
    title VARCHAR(128) NOT NULL,
    body VARCHAR(1024) NOT NULL,
    timestamp DATETIME NOT NULL,
    attendance BOOLEAN NOT NULL,
    PRIMARY KEY ( post_id )
);

CREATE TABLE r_comments(
    comment_id INT NOT NULL AUTO_INCREMENT,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    reply_id INT,
    body VARCHAR(1024) NOT NULL,
    timestamp DATETIME NOT NULL,
    PRIMARY KEY ( comment_id )
);

CREATE TABLE r_attendances(
    attendance_id INT NOT NULL AUTO_INCREMENT,
    post_id INT NOT NULL,
    user_id INT NOT NULL,
    PRIMARY KEY ( attendance_id )
);

CREATE TABLE r_alerts(
    alert_id INT NOT NULL AUTO_INCREMENT,
    user_id INT NOT NULL,
    body VARCHAR(1024) NOT NULL,
    timestamp DATETIME NOT NULL,
    PRIMARY KEY ( alert_id )
);

/* INSERT USERS */
/* Default passwords are all "test" */
INSERT INTO r_users(username, password, firstname, lastname, email) VALUES('Studenttester1', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'RPITester', '1', 'studenttester1@rpi.edu');
INSERT INTO r_users(username, password, firstname, lastname, email) VALUES('Admintester', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'Admin', 'Tester', 'sisman@rpi.edu');
INSERT INTO r_users(username, password, firstname, lastname, email) VALUES('ethantest', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'Ethan', 'Goedken', 'ethan@rpi.edu');
INSERT INTO r_users(username, password, firstname, lastname, email) VALUES('lanyatest', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'Lanya', 'Xiang', 'lanya@rpi.edu');
INSERT INTO r_users(username, password, firstname, lastname, email) VALUES('giotest', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'Gio', 'Tremari', 'gio@rpi.edu');
INSERT INTO r_users(username, password, firstname, lastname, email) VALUES('huntertest', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'Hunter', 'Harris', 'hunter@rpi.edu');
INSERT INTO r_users(username, password, firstname, lastname, email) VALUES('zhaoxitest', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'Zhaoxi', 'Xiang', 'zhaoxi@rpi.edu');
INSERT INTO r_users(username, password, firstname, lastname, email, logo) VALUES('sisman', '$2y$10$u.484SFpXia7mT5gAXXzuOELikh8ejR9QKEbUrTzneCyCim7e7ot6', 'SIS', 'Man', 'sisman@rpi.edu', 'user_content/users/sisman.png');

/* INSERT GROUPS */
INSERT INTO r_groups(name, tagline, logo, visibility) VALUES('RPISEC', 'RPISEC is the resident computer security club at RPI. We are a student-run organization which was founded to provide resources for students interested in exploring the world of computer security.', 'user_content/groups/rpisec.jpg', 'public');
INSERT INTO r_groups(name, tagline, visibility) VALUES('RCOS', 'RCOS is for making cool apps (not unlike this one)', 'public');
INSERT INTO r_groups(name, tagline, visibility) VALUES('Partial Credit', 'Partial Credit is one of RPI\'s four a cappella groups. Established in 2003, this co-ed group enjoys singing music of all kinds.', 'public');
INSERT INTO r_groups(name, tagline, visibility) VALUES('Trudge', 'Ten Really Ugly Dudes Getting Even, the RPI men\'s ultimate disc club is the school\'s premier sporting team. They can throw that plastic around like nobody\'s business!', 'public');
INSERT INTO r_groups(name, tagline, visibility) VALUES('Strut', 'Strut is the RPI women\'s ultimate disc club and is the school\'s second premier sporting team. They can throw that plastic around like nobody\'s business!', 'public');
INSERT INTO r_groups(name, tagline, visibility) VALUES('Ski Team', 'This is the homepage of the RPI Ski Racing team. We race slalom and giant slalom during the winter season and compete against colleges from around the state.', 'public');

/* Generate Permissions */
INSERT INTO r_permissions(user_id, group_id, description) VALUES('1', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('2', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('3', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('4', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('5', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('6', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('7', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '0', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '1', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '2', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '3', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '4', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '5', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '6', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '7', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '8', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('4', '3', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('4', '6', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('5', '5', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('6', '4', 'post');
INSERT INTO r_permissions(user_id, group_id, description) VALUES('8', '2', 'post');

/* INSERT SUBSCRIPTIONS */
INSERT INTO r_subscriptions(user_id, group_id) VALUES ('8','1'),('8','2'),('8','3'),('8','4'),('8','5'),('8','6');
INSERT INTO r_subscriptions(user_id, group_id) VALUES ('3','3'),('3','4'),('3','5'),('3','6');
INSERT INTO r_subscriptions(user_id, group_id) VALUES ('4','1'),('4','2'),('4','5');
INSERT INTO r_subscriptions(user_id, group_id) VALUES ('5','1'),('5','4'),('5','6');
INSERT INTO r_subscriptions(user_id, group_id) VALUES ('6','1'),('6','2');
INSERT INTO r_subscriptions(user_id, group_id) VALUES ('7','1'),('7','2'),('7','6');

/* INSERT POSTS */
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('1', '8', 'RPISEC Weekly Meeting', 'Club Meeting in CII 4050 on Friday Oct 18 from 5:00pm to 7:00pm', '2019-10-15 09:34:21', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('1', '8', 'Meeting Reschedule', 'Club Meeting next week rescheduled to Monday Oct 28 from 5-7', '2019-10-30 15:35:20', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('1', '5', 'Capture The Flag', 'CTF Competition from Tue, 3 Dec. 2019, 10:00 UTC - Thu, 24 Oct. 2019, 10:00 UTC', '2019-11-30 20:18:57', false);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('3', '4', 'Wizard of Ahhs Fall Show', 'Come see Partial Credit perform at the Chapel and Cultural Center on Saturday, November 24th at 8:00pm', '2019-11-20 20:00:00', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('3', '3', 'Rehearsal', 'Partial Credit rehearsal will be from 7-9pm in the DCC on Tuesdays for the remainder of the semester.', '2019-12-01 08:00:00', false);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('3', '4', 'Music Video Release', 'Check out Partial Credit\'s new music video at https://www.youtube.com/user/PartialCreditRPI/featured', '2019-12-02 10:00:00', false);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('4', '6', 'Trudge Practice', 'Ultimate frisbee practice will be happeneing on Anderson Field in the snow tonight!', '2019-12-03 10:00:00', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('4', '6', 'Tournament Interest Poll', 'Please respond to this post if you plan on attending the upcoming tournament on December 25th! Christmas Frisbee!!!', '2019-12-01 16:30:00', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('5', '5', 'Strut Practice', 'Ultimate frisbee practice will be happeneing on Anderson Field in the snow tonight!', '2019-12-03 10:00:00', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('5', '5', 'Tournament Interest Poll', 'Please respond to this post if you plan on attending the upcoming tournament on December 25th! Christmas Frisbee!!!', '2019-12-01 16:2:00', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('5', '5', 'Have a Happy Winter Break!', 'Hey Strut! I hope you all have a great thanksgiving break. Have fun seeing your family and take a well deserved break if you can afford to.', '2019-11-27 15:20:00', false);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('6', '4', 'Training Trip', 'The training trip this year will be from January 6-9. We will leave campus at 3:00pm and arrive at the Air B&B around 5. We will load skis into the cars in the mornings and ski during the day. The first half of each day will be spent with a coach working on technique in the gates. The second half will be directed free skiing. We will do slalom on the first two days and giant slalom on the last two. Total cost will be aroun $300 and can be charged to your bursar.', '2019-11-29 17:00:00', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('6', '4', 'First Training Practice', 'Be at the horseshoe in front of the Union to load the vehicles at 4:30pm on Thursday. We will be training on West Mountain and expect to be home by 10pm.', '2019-12-01 14:23:00', true);
INSERT INTO r_posts(group_id, user_id, title, body, timestamp, attendance) VALUES('2', '8', 'What is RCOS', 'RCOS stands for Rensselaer Center for Open Source. Wow.', '2018-12-26 23:23:00', false);

/* INSERT ATTENDANCES */
INSERT INTO r_attendances(post_id, user_id) VALUES ('8', '3');
INSERT INTO r_attendances(post_id, user_id) VALUES ('4', '3'),('7', '3'),('8', '3'),('10', '3'),('12', '3'),('13', '3');

INSERT INTO r_alerts(user_id, body, timestamp) VALUES('1', 'School is closed Monday due to excessive snow!', '2019-10-30 20:18:57');


quit